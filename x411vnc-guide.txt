# üñ•Ô∏è Linux LAN VNC Monitoring Setup (Updated)

Complete guide to set up **LAN-based desktop monitoring and control** using **x11vnc**, **Remmina**, and **Avahi** (`.local` hostnames).
Now includes a fix for the **‚Äúnot local / :0‚Äù VNC error**.

---

## ‚öôÔ∏è Overview

* **Controller PC:** Used to view/control others.
* **Client PCs:** Machines to be monitored.
* **Network:** Must be same LAN/subnet.
* **Naming:** Use `.local` hostnames (like `pc-b.local`) for automatic detection.

---

## üß© Step 1 ‚Äî Check LAN Connectivity

On both PCs:

```bash
ip a | grep inet
```

Example:

```
Controller: 172.16.5.10
Client:     172.16.5.22
```

If both share the same subnet ‚Üí ‚úÖ OK

---

## üñ•Ô∏è Step 2 ‚Äî On the Client (Machine to Control)

### 1. Set Hostname

```bash
sudo hostnamectl set-hostname pc-b
```

### 2. Install Packages

```bash
sudo apt update
sudo apt install x11vnc avahi-daemon -y
```

### 3. Enable Avahi for `.local`

```bash
sudo systemctl enable --now avahi-daemon
```

### 4. Set VNC Password

```bash
x11vnc -storepasswd
```

### 5. Start VNC Server

```bash
x11vnc -forever -usepw -shared -auth guess -display :0
```

Keep the terminal open ‚Äî the display is now shared on **port 5900**.

---

## üíª Step 3 ‚Äî On the Controller (Viewer PC)

### 1. Install Remmina

```bash
sudo apt update
sudo apt install remmina -y
```

### 2. Connect via Remmina

* **Protocol:** VNC
* **Server:** `pc-b.local:5900`
* **Password:** (the one you set)

‚úÖ You should now see and control the client desktop.

---

## üîÑ Step 4 ‚Äî Auto-Start VNC on Boot (Client)

```bash
sudo nano ~/.bashrc
```

Add this line at the end:

```bash
x11vnc -forever -usepw -shared -auth guess -display :0 &
```

Now x11vnc starts after every login.

---

## üß† Step 5 ‚Äî Test `.local` Discovery

From the controller:

```bash
ping pc-b.local
```

If it replies, Avahi is working fine.

---

## üõ†Ô∏è Troubleshooting & Fixes

### 1Ô∏è‚É£ Avahi / Hostname Not Found

```bash
sudo apt install avahi-daemon -y
sudo systemctl enable --now avahi-daemon
sudo systemctl restart avahi-daemon
```

Then test again:

```bash
ping pc-b.local
```

---

### 2Ô∏è‚É£ ‚ÄúNot Local‚Äù / `:0` Error Fix (VNC Not Showing Desktop)

If you see messages like:

```
pc-b:0 not local
unable to open display :0
```

Follow these exact steps:

```bash
pkill x11vnc
echo $DISPLAY
who
```

You‚Äôll see something like:

```
zohaib  tty7  Nov  3 08:21 (:0)
```

‚Üí Display is `:0` and user is `zohaib`.

Then start x11vnc manually with correct auth:

```bash
x11vnc -usepw -forever -shared -auth /home/zohaib/.Xauthority -display :0
```

If you‚Äôre unsure where `.Xauthority` is:

```bash
find /home -name ".Xauthority"
```

When it starts successfully, it should say:

```
The VNC desktop is: pc-b:0
```

‚úÖ Connect again via `pc-b.local:5900`.

---

### 3Ô∏è‚É£ VNC Running But Connection Refused

Check port:

```bash
sudo ss -tulpn | grep 5900
```

If not found, restart x11vnc manually using the above command.

---

### 4Ô∏è‚É£ Works by IP But Not `.local`

Reinstall or restart Avahi on both:

```bash
sudo apt install avahi-daemon -y
sudo systemctl restart avahi-daemon
```

---

### 5Ô∏è‚É£ Different Subnets (e.g., 192.168.x.x vs 172.16.x.x)

Ensure all are connected to the same router/switch.
Adjust Sophos or LAN policies if needed.

---

### 6Ô∏è‚É£ DHCP / Changing IPs

Use `.local` names ‚Äî they work fine even with changing IPs.
Optionally reserve static IPs in Sophos DHCP using each machine‚Äôs MAC address.

---

### 7Ô∏è‚É£ Optional: Scan for All Active Clients

```bash
sudo apt install nmap -y
nmap -p5900 --open 172.16.5.0/24
```

This lists all machines running x11vnc.

---

## ‚úÖ Summary Table

| Department | Hostname | Connect String           |
| ---------- | -------- | ------------------------ |
| HR         | hr01     | `vnc://hr01.local:5900`  |
| Finance    | fin01    | `vnc://fin01.local:5900` |
| Support    | sup01    | `vnc://sup01.local:5900` |
| IT         | it01     | `vnc://it01.local:5900`  |

---

## üéØ Result

You now have a **LAN-only**, **zero-latency**, **free** remote control setup:

* Works even if IPs change
* No internet dependency
* Supports 200+ clients
* Integrates easily with systems like NodeHQ




Run x11vnc like this instead of the default:

x11vnc -rfbport 5900 -shared -forever -ncache 10 -ncache_cr -nopw -o /tmp/x11vnc.log -display :0 -nocursorshape -nocursorpos -noxdamage -nosel


What this does:

-ncache 10 -ncache_cr ‚Üí local frame caching (less lag on mouse move)

-noxdamage ‚Üí avoids partial frame diffs that cause lag spikes

-nocursorshape / -nocursorpos ‚Üí stops pointer sync lag

-nosel ‚Üí disables clipboard sync delays

This alone removes 70‚Äì80% of perceived latency.
